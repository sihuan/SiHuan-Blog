<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="SiHuan,思还,Blog,博客,GitBlog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="SiHuan's Blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="SiHuan's Blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="/assets/galileo-3f2347c2c0.css">
    <link rel="stylesheet" href="/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "/cd4d997a10db5df83c4a353817e98635.json"
        }
    </script>
    
<title>JuNest！ - SiHuan's Blog</title>
<meta name="author" content="SiHuaN" />
<meta name="description" content="在无 root 权限的情况下在其他任意 Linux 发行版上运行 ArchLinux" />
<meta property="og:title" content="JuNest！ - SiHuan's Blog" />
<meta property="og:description" content="在无 root 权限的情况下在其他任意 Linux 发行版上运行 ArchLinux" />
<meta property="og:site_name" content="SiHuan's Blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/junest/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2024-01-31T11:06:00-00.00" />
<meta name="twitter:title" content="JuNest！ - SiHuan's Blog" />
<meta name="twitter:description" content="在无 root 权限的情况下在其他任意 Linux 发行版上运行 ArchLinux" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/" target="_self">
                            <img src="/logo.png" alt="SiHuan's Blog">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/">SiHuan's Blog</a></h1>
                        <p>道阻且长，吾意思还。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/enngi/" target="_self">縁起</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/publickey/" target="_self">公钥</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">JuNest！</h1>
            <span class="ga-post_meta ga-mono">
                <span>SiHuaN</span>
                <time>
                    2024-01-31
                </time>
                
                in <a no-style class="category" href="/category/分享/">
                    分享
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <blockquote><p>有些时候可能会拿到一些没有 root 权限的机器，找管理员安装软件不方便，而自己编译安装软件管理起来也比较麻烦，还要处理各种依赖。在群友 SteamedFish 的推荐下用上了 JuNest 这个工具。如果之前有使用过 ArchLinux 的包管理的话，用起来会很舒服～ 没有的话 <code>pacman</code> 也挺好学的。<br>
主要应用场景就是在没有 root 权限的机器上安装各种软件）<br>
这个项目托管在 GitHub : <a href="https://github.com/fsquillace/junest">https://github.com/fsquillace/junest</a></p>
</blockquote>
<h2>起因</h2>
<p>我自己拿到了一台服务器的账号，但是没有 root 权限，上面缺很多软件，还有一些软件比较老旧。host 机器的操作系统是 Debian，一开始我尝试直接使用 apt download 下载软件包，然后 dpkg 安装到我的家目录，后来发现依赖处理起来很麻烦。然后在群友的推荐下去了解了 <code>nix</code>、<code>gentoo-prefix</code> 和  <code>linuxbrew</code> 等工具，一番文档看下来，发现它们大多在安装时候需要 root 权限（后续使用可能不用），而完全不需要 root 权限的 <code>portable-nix</code> 现在看起来缺乏维护。最后了解到了 <code>junest</code>，太好用了！于是写篇博客记录一下，主要介绍一下安装方法，和后续使用中我自己的一些习惯（之后可能会写一下如何直接 ssh 连入到 <code>junest</code> 的容器中去，主要应用场景就是给 vscode remote 用了）。</p>
<h2>准备</h2>
<h3>读项目介绍</h3>
<p><strong>JuNest</strong> (Jailed User Nest) is a lightweight Arch Linux based distribution
that allows the creation of disposable and partially isolated GNU/Linux environments
within any generic GNU/Linux host OS and without requiring root
privileges to install packages.</p>
<p>JuNest is built around <a href="https://wiki.archlinux.org/index.php/Pacman">pacman</a>,
the Arch Linux package manager, which allows access
to a wide range of packages from the Arch Linux repositories.</p>
<p>The main advantages of using JuNest include:</p>
<ul>
<li>Install packages without root privileges.</li>
<li>Create partially isolated environments in which you can install packages without risking mishaps on production systems.</li>
<li>Access a wider range of packages, particularly on GNU/Linux distros with comparatively limited repositories (such as CentOS and Red Hat).</li>
<li>Run on a different architecture from the host OS via QEMU.</li>
<li>Available for <code>x86_64</code> and <code>arm</code> architectures but you can build your own image from scratch too!</li>
<li>All Arch Linux lovers can enjoy their favourite distro everywhere!</li>
</ul>
<p>JuNest follows the <a href="https://wiki.archlinux.org/index.php/The_Arch_Way">Arch Linux philosophy</a>.</p>
<h3>准备系统</h3>
<p>你至少要有一个可以登录的账户，全过程不需要 root 权限，junest 支持 <code>namespace</code>、<code>proot</code> 和 <code>chroot</code> 三种后端，其中 <code>chroot</code> 需要 root 权限，就不多做讨论了。前两者我更推荐 <code>namespace</code> 的实现，具体区别可以去阅读 junset 的文档（<del>其实在 junest 的文档里安装使用也写得很清楚了</del>）。可以查阅<a href="https://github.com/fsquillace/junest/wiki/Linux-distros-with-user-namespace-enabled-by-default">这个表格</a>来查看自己的 host 系统是否默认开启了用户命名空间。ArchLinux 和比较新版本的 Debian、Ubuntu 都是开了的。</p>
<h2>安装</h2>
<blockquote><p>junest 还是有一些依赖的，需要服务器上已经满足以下依赖<br>
bash (&gt;=4.0) GNU coreutils<br>
另外安装过程中有用到 git</p>
</blockquote>
<p>使用 ssh 链接到服务器，将 junest 仓库 clone 到 <code>~/.local/share/junest</code></p>
<div class="highlight"><pre><span></span><span class="c1"># 新建目录</span>
mkdir<span class="w"> </span>~/.local/share/junest
<span class="c1"># clone 仓库（网络问题是另外的话题）</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/fsquillace/junest.git<span class="w"> </span>~/.local/share/junest
</pre></div>
<p>将 junest 添加到 PATH，以便你可以方便的使用它</p>
<div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>~/.local/share/junest/bin:<span class="nv">$PATH</span>
</pre></div>
<p>如果不想每次都执行上述 export 命令可以将它写入到 <code>~/.bashrc</code> 中，追加到文件末尾即可。完成编辑后需要执行 <code>source ~/.bashrc</code> 生效，或者干脆登出 ssh 重新登录。</p>
<p>现在你可以设置 <code>JUNEST_HOME</code> 这个环境变量以控制 junest 的安装位置，默认是 <code>.junest</code>，我是使用了默认的位置</p>
<p>使用以下命令完成安装</p>
<div class="highlight"><pre><span></span>junest<span class="w"> </span>setup
</pre></div>
<p>等待执行完成，没有出错的话就完成了安装。</p>
<h2>使用 junest 环境</h2>
<p>在你完成安装之后，ssh 连入服务器是在 host 机器的环境当中，现在你使用的各种工具都是 host 机器提供的。<br>
有以下几种方式可以使用 junest 里的 archlinux 提供的软件。</p>
<ol>
<li><p>使用 junest 命令进入到容器里</p>
<div class="highlight"><pre><span></span><span class="c1"># 进入容器</span>
<span class="w"> </span>junest
<span class="w"> </span><span class="c1"># 现在已经在 junest 里面了，所以可以使用 pacman</span>
<span class="w"> </span>pacman<span class="w"> </span>--version
</pre></div>
</li>
<li><p>给 junest 命令传递参数（？）</p>
<div class="highlight"><pre><span></span><span class="c1"># 现在是在 host 环境上，直接运行以下命令来使用 junest 容器里的 pacman</span>
<span class="w"> </span>junest<span class="w"> </span>pacman<span class="w"> </span>--version
</pre></div>
</li>
<li><p>直接在 host 机器上使用 junest 里安装的程序</p>
<p>我不推荐这种方式，原因是这种情况会优先使用 host 机器上的程序，如果你 host 机器上安装了老版本（不符合需求的）程序，junest 里安装了新的版本，在这种情况下会优先使用 host 机器上的版本。<br>
 如果确实这种方式的，可以参考官方文档：<a href="https://github.com/fsquillace/junest/tree/master?tab=readme-ov-file#run-junest-installed-programs-directly-from-host-os">https://github.com/fsquillace/junest/tree/master?tab=readme-ov-file#run-junest-installed-programs-directly-from-host-os</a></p>
</li>
</ol>
<p>我自己比较推荐第一种方式，就是直接进入到 junest 容器中，完全使用 junest 里的程序，和 host 机器划清界限（<br>
可以在 <code>~/.bashrc</code> 中追加以下内容来使每次 ssh 连入后自动进入 junest 环境。</p>
<div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span>/usr/bin/pacman<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>junest
<span class="k">fi</span>
</pre></div>
<h2>之后的配置</h2>
<p>通过 junest 命令进入环境之后，你面对的就是一个全新的 archlinux 系统了，在这里你拥有（虚假的）root 权限，可以使用 sudo 命令<br>
再一切开始之前，你需要编辑 pacman 的配置文件来启用一个镜像站点。</p>
<p>如果你在 junest 里，那么你需要编辑的文件是 <code>/etc/pacman.d/mirrorlist</code>，如果 junest 环境里尚未有你喜欢的编辑工具，可以使用 <code>exit</code> 命令或 <code>Ctrl+D</code> 退出 junest 到 host 环境，然后利用 host 环境里已经有的编辑工具去编辑 <code>~/.junest/etc/pacman.d/mirrorlist</code>。</p>
<p>在上面提及的 mirrorlist 文件最前段添加你想使用的镜像站站点，比如，要使用山东科技大学的开源镜像网站，添加以下内容</p>
<div class="highlight"><pre><span></span>Server = https://mirrors.sdust.edu.cn/archlinux/$repo/os/$arch
# 清华大学 tuna 镜像站的话就是以下内容
# Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
</pre></div>
<p>完成上述编辑之后，确保你回到 junest 环境中，执行以下命令来更新一下 junest 里的 archlinux 同时安装一些相当基础的软件</p>
<div class="highlight"><pre><span></span>sudo<span class="w"> </span>pacman<span class="w"> </span>-Syyu
sudo<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>glibc
</pre></div>
<p>完成之后你就可以用 pacman 来安装自己所需的软件包了，例如</p>
<div class="highlight"><pre><span></span><span class="c1"># 安装 vim、ninja、cmake 和 python</span>
sudo<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>vim<span class="w"> </span>ninja<span class="w"> </span>cmake<span class="w"> </span>python
</pre></div>
<p>关于 pacman 的用法可以去看 archlinux 的文档，另外需要注意 archlinux 上有些包名可能和你正在使用的发行版不一样，可以用 <code>-Ss</code> 参数来查找软件包，例如</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>pacman<span class="w"> </span>-Ss<span class="w"> </span>ninja
<span class="go">extra/gn 0.2130.7367b0df-1</span>
<span class="go">    Meta-build system that generates build files for Ninja</span>
<span class="go">extra/ninja 1.11.1-3 [installed]</span>
<span class="go">    Small build system with a focus on speed</span>
<span class="go">extra/ninjas2 0.2.0-3</span>
<span class="go">    A sample slicer audio plugin</span>
<span class="go">extra/ninjas2-lv2 0.2.0-3 (lv2-plugins pro-audio)</span>
<span class="go">    A sample slicer audio plugin - LV2 plugin</span>
<span class="go">extra/ninjas2-standalone 0.2.0-3 (pro-audio)</span>
<span class="go">    A sample slicer audio plugin - JACK standalone</span>
<span class="go">extra/ninjas2-vst 0.2.0-3 (vst-plugins pro-audio)</span>
<span class="go">    A sample slicer audio plugin - VST plugin</span>
<span class="go">extra/samurai 1.2-2</span>
<span class="go">    ninja-compatible build tool written in C</span>
</pre></div>
<p>具体的用法还是去参考 archlinux 的文档吧～</p>
<p>现在你可以在 junest 里自由的安装并使用各种所需的软件而全程不需要 host 机器的 root 权限。</p>
<h2>挖坑</h2>
<p>有时候可能会有直接 ssh 连接到 junest 容器里的需求（而不是先连接到 host 机器，再使用 junest 命令进入容器），我的应用场景就是给 vscode remote 用。大概需要以下步骤</p>
<ul>
<li><p>给 junest 里的 archlinux 安装一个打过补丁的 openssh（为的是解决一点小小的权限问题）</p>
</li>
<li><p>配置并启动 junest 里的 sshd 服务</p>
</li>
<li><p>可能的，如果你的 host 机器有防火墙，不能将 junest 里的 sshd 服务暴露到你可以访问的网络上，就需要配置下跳板</p>
</li>
</ul>
<p>关于上述步骤可以参考  <a href="https://medium.com/@ayaka_45434/installing-packages-on-linux-without-sudo-privilege-using-junest-5fe7523c9d86#:~:text=Step%205%3A%20Install%20and%20run%20an%20SSH%20server%20in%20the%20JuNest%20environment">@ayaka_45434/installing-packages-on-linux-without-sudo-privilege-using-junest</a></p>
<p>具体步骤和可能踩的坑我可能也许大概会再水一篇 blog :)</p>
<p><strong>EOF</strong></p>
<p>快去看 It's MyGO 吧，相当好看😭😭😭</p>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/Linux 技巧/">#Linux 技巧</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/ArchLinux/">#ArchLinux</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/junest/">#junest</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <h3>没有了</h3>
        <p class="yue">这是最新的文章</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/archives/oe2203sp2-install-ros/">在 openEuler 22.03 SP2 上安装 ROS humble</a>
        <p class="yue">openEuler 22.03 SP2 支持 ROS humble 啦！快来试一试）</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">SiHuan's Blog</span>
                    </section>
                    <section>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2020-01-01T00:00+08:00"
                    </script>
                    <script src="/assets/galileo-61cf2e8279.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/ExSearch/jquery.min.js"></script>
    <script src="/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="/assets/katex.min.css">
    <script defer src="/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>
<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="SiHuan,思还,Blog,博客,GitBlog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="SiHuan's Blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="SiHuan's Blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="/assets/galileo-3f2347c2c0.css">
    <link rel="stylesheet" href="/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "/23ede53f64c8962a28f887c1d6b1654e.json"
        }
    </script>
    
<title>vps2arch! - SiHuan's Blog</title>
<meta name="author" content="SiHuan" />
<meta name="description" content="The fastest way to convert a VPS to Arch Linux!" />
<meta property="og:title" content="vps2arch! - SiHuan's Blog" />
<meta property="og:description" content="The fastest way to convert a VPS to Arch Linux!" />
<meta property="og:site_name" content="SiHuan's Blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/vps2arch/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2020-03-13T11:06:00-00.00" />
<meta name="twitter:title" content="vps2arch! - SiHuan's Blog" />
<meta name="twitter:description" content="The fastest way to convert a VPS to Arch Linux!" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/" target="_self">
                            <img src="/logo.png" alt="SiHuan's Blog">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/">SiHuan's Blog</a></h1>
                        <p>道阻且长，吾意思还。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/enngi/" target="_self">縁起</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/publickey/" target="_self">公钥</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">vps2arch!</h1>
            <span class="ga-post_meta ga-mono">
                <span>SiHuan</span>
                <time>
                    2020-03-13
                </time>
                
                in <a no-style class="category" href="/category/分享/">
                    分享
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <blockquote><p>有些 vps 服务商是不提供 Arch 系统的，但是你仍然可以通过 vps2arch 脚本将你的系统切换到 Archlinux</p>
<p>这个项目托管在 gitlab : <a href="https://gitlab.com/drizzt/vps2arch/">https://gitlab.com/drizzt/vps2arch/</a></p>
</blockquote>
<h2>准备</h2>
<h3>读项目介绍</h3>
<blockquote><p>This script is used to convert a <em>VPS</em>, running another linux distro, to <em>Arch Linux</em>.
 It should be <strong>only</strong> used if your <em>VPS</em> provider doesn't provide you an <em>Arch Linux</em> image.</p>
</blockquote>
<h3>读项目免责</h3>
<blockquote><p>I'm not responsible for any damage in your system and/or any violation of the agreement between you and your vps provider.
 <strong>Use at your own risk!</strong></p>
</blockquote>
<h3>准备系统</h3>
<p>你需要有一个干净的系统，既然都要把系统重新安装成 Arch 了，提前重置一下系统不为过吧。</p>
<p>推荐重置为 <code>CentOS</code> 或者 <code>Debain</code> 这个脚本在 <code>Ubuntu 18</code> 上也许有一些问题。</p>
<h2>开干</h2>
<p>使用 SSH 链接到你的 VPS，在开始之前你可以修改一下 root 密码，以为 vps2arch 会将新系统的密码设置为你运行脚本之前的 root 密码</p>
<div class="highlight"><pre><span></span>passwd root
</pre></div>
<p>你需要输入两次新密码，并且输入密码没有回显</p>
<p>接下来就是重点了，以 root 身份执行一下命令</p>
<div class="highlight"><pre><span></span><span class="c1"># 下载 vps2arch 脚本</span>
<span class="c1"># wget https://tinyurl.com/vps2arch 也会被重定向到以下 url</span>
wget https://gitlab.com/drizzt/vps2arch/-/raw/master/vps2arch
<span class="c1"># 赋予执行权限</span>
chmod +x vps2arch
<span class="c1"># 启动脚本！</span>
./vps2arch
<span class="c1"># 当你从脚本默认的源下载速度较慢的时候，可以使用 -m 参数指定源，例如</span>
<span class="c1"># ./vps2arch -m https://mirrors.neusoft.edu.cn/archlinux/</span>
</pre></div>
<p>深呼吸，不出意外的话，等待几分钟你会得到这样的提示</p>

<pre><code>When you are finished with your post-installation, you'll need to reboot the VM the rough way:
        # sync ; reboot -f

Then you'll be able to connect to your VM using SSH and to login using your old root password (or "vps2arch" if you didn't have a root password).</code></pre>
<p>按照提示执行 <code>sync ; reoot -f</code> 重启你的 VPS。</p>
<p>这时候你的 SSH 链接会断掉，在 VPS 重启的这几分钟里，你需要去 <code>~/.ssh/konwn_host</code> 里删除掉刚刚运行 vps2arch 脚本的主机所在的行，因为换了新系统了你的电脑已经不再认识远程主机了，不这么做的话你在下次链接的时候会得到一个错误。稍等一会 <code>ssh root@yourip</code> 输入之前的 root 密码</p>
<p><strong>Welcome to ArchLinux!</strong></p>
<h2>之后的配置</h2>
<p>现在你已经得到一个崭新的 ArchLinux 系统了，接下来是在正常使用之前的一些建议，以下建议多来源于 <a href="https://wiki.archlinux.org/index.php/Installation_guide">ArchWiki</a> .</p>
<h3>时间设置</h3>
<div class="highlight"><pre><span></span><span class="c1"># 使用 ntp</span>
timedatectl set-ntp <span class="nb">true</span>
<span class="c1"># 设置时区</span>
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc
</pre></div>
<h3>设置中文</h3>
<p>这时候你的系统还是不支持中文的，输入中文将会乱码，我们需要进行一下操作。</p>
<p>编辑 <code>/etc/locale.gen</code> 取消一下行的注释</p>

<pre><code>en_US.UTF-8 UTF-8
zh_CN.UTF-8 UTF-8
zh_TW.UTF-8 UTF-8</code></pre>
<p>执行 <code>locale-gen</code></p>
<p>创建 <code>/etc/locale.conf</code> 并编辑 <code>LANG</code> 这一 <a href="https://wiki.archlinux.org/index.php/Variable">变量</a>，比如：</p>

<pre><code>LANG=en_US.UTF-8</code></pre>
<h3>添加 ArchLinuxCN 源</h3>
<p>编辑 <code>/etc/pacman.conf</code> ，在文件末尾添加</p>

<pre><code>[archlinuxcn]
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch</code></pre>
<p>之后执行</p>
<div class="highlight"><pre><span></span>pacman -Syy
pacman -S archlinuxcn-keyring
</pre></div>
<h3>添加用户</h3>
<blockquote><p>一直使用 root 用户是不太安全的！我们来添加一个新的用户</p>
</blockquote>
<p>接下来的命令中，新的用户名以 <em>sihuan</em> 为例，执行替换</p>
<div class="highlight"><pre><span></span>useradd -m -G wheel sihuan
</pre></div>
<blockquote><p>useradd 是 archlinux 系统添加用户的命令</p>
<p>-m 参数代表自动创建用户的家目录，这个例子里是 <code>/home/sihuan</code></p>
<p>-G 参数意味着用户要加入一些个的附加组，这儿即 <code>wheel</code> 组</p>
</blockquote>
<p>设置新用户密码</p>
<div class="highlight"><pre><span></span>passwd sihuan
</pre></div>
<p>然后输入两次密码就好了</p>
<p>设置 sudo</p>
<p>首先安装 sudo</p>
<div class="highlight"><pre><span></span>pacman -S sudo
</pre></div>
<p>编辑配置文件</p>
<div class="highlight"><pre><span></span>visudo
</pre></div>
<p>找到下面一行，取消掉注释</p>
<div class="highlight"><pre><span></span>%wheel <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> ALL
</pre></div>
<h3>配置新用户的 shell</h3>
<blockquote><p>建议大家都自己整一个 <code>dotfiles</code> ，具体可以看 fc 老师翻译的 <a href="https://farseerfc.me/using-gnu-stow-to-manage-your-dotfiles.html">这篇文章</a></p>
</blockquote>
<p>以下就以我自己的为例，如果有时间我会详细的解释以下我的 <code>dotfiles</code> 包含了什么</p>
<p>切换到新的用户</p>

<pre><code>su sihuan</code></pre>
<p>输入密码</p>
<p>接下来的操作就是在 <em>sihuan</em> 这个用户里进行的啦</p>
<div class="highlight"><pre><span></span><span class="c1"># 安装需要的软件包</span>
sudo pacman -S git stow zsh grml-zsh-config powerline ranger exa zsh-autosuggestions zsh-syntax-highlighting zsh-history-substring-search
<span class="c1"># 克隆 dotfiles 仓库</span>
git clone https://github.com/Si-Huan/dotfiles
<span class="c1"># 切换 shell 到 zsh</span>
chsh -s zsh
<span class="c1"># 使 zsh 配置生效</span>
<span class="nb">cd</span> dotfiles
stow zsh
</pre></div>
<p>这时候远程主机上的配置就完成了！再次使用 <em>sihuan</em> 这个用户登陆，你就会得到一个很 OK 的 shell 体验。</p>
<h2>免密登录和 SSH 主机别名</h2>
<div class="highlight"><pre><span></span>ssh-keygen
ssh-copy-id sihuan@hostip
</pre></div>
<p>Edit <code>~/.ssh/config</code> add:</p>

<pre><code>Host hostname
    HostName hostip
    User sihuan</code></pre>
<p>Then you can login your host with:</p>

<pre><code>ssh hostname</code></pre>
<p>And you will no longer be asked for a password.</p>
<p><strong>EOF</strong></p>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/Linux 技巧/">#Linux 技巧</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/ArchLinux/">#ArchLinux</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/vps2arch/">#vps2arch</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/archives/shitama1/">Shitama 代码分析</a>
        <p class="yue">真就强行分析呗。</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/archives/使用pb分享代码/">使用 pb 分享代码</a>
        <p class="yue">以更优雅的方式分享你的代码或者终端输出</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">SiHuan's Blog</span>
                    </section>
                    <section>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2020-01-01T00:00+08:00"
                    </script>
                    <script src="/assets/galileo-61cf2e8279.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/ExSearch/jquery.min.js"></script>
    <script src="/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="/assets/katex.min.css">
    <script defer src="/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>
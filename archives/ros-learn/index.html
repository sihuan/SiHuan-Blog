<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="SiHuan,思还,Blog,博客,GitBlog" />
    <meta name="generator" content="Maverick 1.1" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="SiHuan's Blog &raquo; RSS 2.0" href="/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="SiHuan's Blog &raquo; ATOM 1.0" href="/feed/atom/index.xml" />
    <link rel="stylesheet" href="/assets/galileo-3f2347c2c0.css">
    <link rel="stylesheet" href="/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "/cd4d997a10db5df83c4a353817e98635.json"
        }
    </script>
    
<title>ROS 学习笔记 - SiHuan's Blog</title>
<meta name="author" content="SiHuaN" />
<meta name="description" content="一点点 ROS 学习笔记" />
<meta property="og:title" content="ROS 学习笔记 - SiHuan's Blog" />
<meta property="og:description" content="一点点 ROS 学习笔记" />
<meta property="og:site_name" content="SiHuan's Blog" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/archives/ros-learn/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2023-04-22T11:06:00-00.00" />
<meta name="twitter:title" content="ROS 学习笔记 - SiHuan's Blog" />
<meta name="twitter:description" content="一点点 ROS 学习笔记" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/" target="_self">
                            <img src="/logo.png" alt="SiHuan's Blog">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/">SiHuan's Blog</a></h1>
                        <p>道阻且长，吾意思还。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/enngi/" target="_self">縁起</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/publickey/" target="_self">公钥</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">ROS 学习笔记</h1>
            <span class="ga-post_meta ga-mono">
                <span>SiHuaN</span>
                <time>
                    2023-04-22
                </time>
                
                in <a no-style class="category" href="/category/ros/">
                    ros
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <h1>ROS 文件系统</h1>
<h2>catkin 工作空间</h2>
<p>ROS 工程结构如下</p>
<div class="highlight"><pre><span></span>catkin_ws
├── build
│   └── ...
├── devel
│   └── ...
└── src
    ├── CMakeLists.txt -&gt; /opt/ros/kinetic/share/catkin/cmake/toplevel.cmake
    └── exercise_three
        ├── CMakeLists.txt
        ├── include
        │   └── exercise_three
        ├── msg
        │   └── addend.msg
        ├── package.xml
        ├── src
        │   ├── client_call_add.cpp
        │   ├── pub_test.cpp
        │   ├── server_call_add.cpp
        │   └── sub_test.cpp
        └── srv
            └── CallAdd.srv
</pre></div>
<p>catkin 是 cmake 扩展，是 ROS 使用的编译系统。较旧版本可能使用 rosbuild，已弃用。</p>
<p>在 <code>catkin_ws</code> 目录中使用 <code>catkin_make</code> 可以进行工程初始化来生成基础的目录结构（需要 <code>catkin_ws/src</code> 目录存在），编译也使用 <code>catkin_make</code> 命令。</p>
<p>编译时注意目录，需要在 <code>src</code> 目录父目录下，<code>catkin_ws</code>会找到 <code>src</code> 文件夹，然后按文件夹递归查找 package，package 是 catkin 编译最小单位。</p>
<blockquote><p>Tips：编译后需要 <code>source ~/catkin_ws/devel/setip.bash</code>，不过此工作已经在安装一节添加到了 <code>~/.bashrc</code> 中</p>
</blockquote>
<h2>package 组成</h2>
<p>package 即功能包，是 ROS 基本组织形式，也是 catkin 的编译基本单元。</p>
<p>一个 package 可以包括多个可执行文件，在 CMakeLists.txt 中指定生成多个可执行文件即可。</p>
<p>package 认定方式 CMakeLists.txt 和 package.xml</p>
<h3>CMakeLists.txt</h3>
<p><code>CMakeLists.txt</code> 规定了 catkin 的编译规则 。定义了源文件、依赖项和目标文件。 #TODO 读 CMake 实践</p>
<p>包括以下函数</p>
<div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">()</span><span class="w"> </span><span class="c">#CMake的版本号 </span>
<span class="nb">project</span><span class="p">()</span><span class="w">                </span><span class="c">#项目名称 </span>
<span class="nb">find_package</span><span class="p">()</span><span class="w">           </span><span class="c">#找到编译需要的其他CMake/Catkin package</span>
<span class="nb">catkin_python_setup</span><span class="p">()</span><span class="w">    </span><span class="c">#catkin新加宏，打开catkin的Python Module的支持</span>
<span class="nb">add_message_files</span><span class="p">()</span><span class="w">      </span><span class="c">#catkin新加宏，添加自定义Message/Service/Action文件</span>
<span class="nb">add_service_files</span><span class="p">()</span>
<span class="nb">add_action_files</span><span class="p">()</span>
<span class="nb">generate_message</span><span class="p">()</span><span class="w">       </span><span class="c">#catkin新加宏，生成不同语言版本的msg/srv/action接口</span>
<span class="nb">catkin_package</span><span class="p">()</span><span class="w">         </span><span class="c">#catkin新加宏，生成当前package的cmake配置，供依赖本包的其他软件包调用</span>
<span class="nb">add_library</span><span class="p">()</span><span class="w">            </span><span class="c">#生成库</span>
<span class="nb">add_executable</span><span class="p">()</span><span class="w">         </span><span class="c">#生成可执行二进制文件</span>
<span class="nb">add_dependencies</span><span class="p">()</span><span class="w">       </span><span class="c">#定义目标文件依赖于其他目标文件，确保其他目标已被构建</span>
<span class="nb">target_link_libraries</span><span class="p">()</span><span class="w">  </span><span class="c">#链接</span>
<span class="nb">catkin_add_gtest</span><span class="p">()</span><span class="w">       </span><span class="c">#catkin新加宏，生成测试</span>
<span class="nb">install</span><span class="p">()</span><span class="w">                </span><span class="c">#安装至本机</span>
</pre></div>
<h3>package.xml</h3>
<p><code>package.xml</code> 定义了一些包的元信息。可用的标签如下</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;pacakge&gt;</span><span class="w">               </span>根标记文件<span class="w">  </span>
<span class="nt">&lt;name&gt;</span><span class="w">                  </span>包名<span class="w">  </span>
<span class="nt">&lt;version&gt;</span><span class="w">               </span>版本号<span class="w">  </span>
<span class="nt">&lt;description&gt;</span><span class="w">           </span>内容描述<span class="w">  </span>
<span class="nt">&lt;maintainer&gt;</span><span class="w">            </span>维护者<span class="w"> </span>
<span class="nt">&lt;license&gt;</span><span class="w">               </span>软件许可证<span class="w">  </span>
<span class="nt">&lt;buildtool_depend&gt;</span><span class="w">      </span>编译构建工具，通常为catkin<span class="w">    </span>
<span class="nt">&lt;depend&gt;</span><span class="w">                </span>指定依赖项为编译、导出、运行需要的依赖，最常用
<span class="nt">&lt;build_depend&gt;</span><span class="w">          </span>编译依赖项<span class="w">  </span>
<span class="nt">&lt;build_export_depend&gt;</span><span class="w">   </span>导出依赖项
<span class="nt">&lt;exec_depend&gt;</span><span class="w">           </span>运行依赖项
<span class="nt">&lt;test_depend&gt;</span><span class="w">           </span>测试用例依赖项<span class="w">  </span>
<span class="nt">&lt;doc_depend&gt;</span><span class="w">            </span>文档依赖项
</pre></div>
<p>一个例子</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;package</span><span class="w"> </span><span class="na">format=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>exercise_three<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>0.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>The<span class="w"> </span>exercise_three<span class="w"> </span>package<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;maintainer</span><span class="w"> </span><span class="na">email=</span><span class="s">&quot;sihuan@sakuya.love&quot;</span><span class="nt">&gt;</span>sihuan<span class="nt">&lt;/maintainer&gt;</span>
<span class="w">  </span><span class="nt">&lt;license&gt;</span>TODO<span class="nt">&lt;/license&gt;</span>
<span class="w">  </span><span class="nt">&lt;buildtool_depend&gt;</span>catkin<span class="nt">&lt;/buildtool_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>roscpp<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>rospy<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_depend&gt;</span>std_msgs<span class="nt">&lt;/build_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_export_depend&gt;</span>roscpp<span class="nt">&lt;/build_export_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_export_depend&gt;</span>rospy<span class="nt">&lt;/build_export_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;build_export_depend&gt;</span>std_msgs<span class="nt">&lt;/build_export_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>roscpp<span class="nt">&lt;/exec_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>rospy<span class="nt">&lt;/exec_depend&gt;</span>
<span class="w">  </span><span class="nt">&lt;exec_depend&gt;</span>std_msgs<span class="nt">&lt;/exec_depend&gt;</span>

<span class="w">  </span><span class="nt">&lt;export&gt;</span>
<span class="w">  </span><span class="nt">&lt;/export&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</pre></div>
<p><code>rosbuild</code> 等效的文件是 <code>manifest.xml</code>，已经弃用</p>
<h3>package 里的代码文件的组织</h3>
<ul>
<li><p>shell、python 脚本</p>
<blockquote><p>package/scripts/*.{sh,py}</p>
</blockquote>
</li>
<li><p>C++ .h/.cpp</p>
<blockquote><p>package/include</p>
<p>package/src/*.cpp</p>
</blockquote>
</li>
<li><p>自定义的通信格式</p>
<ul>
<li><p>msg 消息</p>
<blockquote><p>package/msg/*.msg</p>
</blockquote>
</li>
<li><p>srv 服务</p>
<blockquote><p>package/srv/*.srv</p>
</blockquote>
</li>
<li><p>actions 动作</p>
</li>
</ul>
</li>
<li><p>launch 文件 负责启动多个可执行文件</p>
<blockquote><p>package/launch/*.launch</p>
</blockquote>
</li>
<li><p>配置文件 格式自定义</p>
<blockquote><p>package/config/*</p>
</blockquote>
</li>
</ul>
<h3>常用包管理指令</h3>
<ol>
<li><p>rospack</p>
<p><code>rospack find *pkg_name*</code>   可以按包名查找 package</p>
<p><code>rospack list</code> 列出所有包</p>
</li>
<li><p>roscd</p>
<p><code>roscd *pkg_name*</code> 进入到指定包目录</p>
</li>
<li><p>rosls</p>
<p><code>rosls *pkg_name*</code> 列出指定包含有的文件</p>
</li>
<li><p>rosed</p>
<blockquote><p>rosed <em>package_name</em> <em>file_name</em></p>
<p>编辑指定包下指定文件</p>
<p>编辑器使用 EDITOR 变量定义，默认为 vim</p>
</blockquote>
</li>
<li><p>catkin_create_pkg</p>
<blockquote><p>catkin_create_pkg <em><pkg_name></em>  [<em>deps</em>]</p>
<p>创建一个包，指定包名和依赖</p>
</blockquote>
</li>
<li><p>rosdep</p>
<blockquote><p>rosdep install [<em>pkg_name</em>]</p>
<p>安装指定包列表的依赖包</p>
</blockquote>
</li>
</ol>
<h3>Metapackage</h3>
<p>元包，虚包，靠依赖引入一系列软件包，将具有相似功能的软件包组织起来</p>
<h1>通信架构</h1>
<h2>master 和 node</h2>
<p>node 节点启动之前需要先向 master 注册，然后通过 master 接受 node 之间可以进行两两点对点通信</p>
<p><strong>启动 master</strong></p>
<p><code>roscore</code></p>
<blockquote><p>会启动 master 节点，rosout 节点（负责日志输出）还有一个 parameter server 参数服务器</p>
</blockquote>
<p>一个 node 就是一个 ROS 的进程，就是 pkg 里的可执行文件在内存运行的实例</p>
<p><strong>node 相关命令</strong></p>
<p><code>rosrun [pkg_name] [node_name]</code></p>
<blockquote><p>启动一个 node</p>
<p>node name 并非可执行文件名，而是在代码里定义的节点名</p>
</blockquote>
<p><code>rosnode</code></p>
<blockquote><p>子命令</p>
<ul>
<li><p>list</p>
<p>列出当前运行的 node 信息</p>
</li>
<li><p>info [node_name]</p>
<p>显示某 node 的详细信息</p>
<p>​  需要 node 正在运行</p>
</li>
<li><p>kill [node_name]</p>
<p>结束某个 node</p>
</li>
</ul>
</blockquote>
<p><code>roslaunch [pkg_name] [file_name.launch]</code></p>
<blockquote><p>批量启动 node</p>
<p>roslaunch 会检测 master 是否在运行，没有运行会先调用 <code>roscore</code> 启动 master</p>
</blockquote>
<p>​   launch 文件的格式为 <code>xml</code>，包含如下标签</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;launch&gt;</span><span class="w">    </span><span class="cm">&lt;!--根标签--&gt;</span>
<span class="nt">&lt;node&gt;</span><span class="w">    </span><span class="cm">&lt;!--需要启动的node及其参数--&gt;</span>
<span class="nt">&lt;include&gt;</span><span class="w">    </span><span class="cm">&lt;!--包含其他launch--&gt;</span>
<span class="nt">&lt;machine&gt;</span><span class="w">    </span><span class="cm">&lt;!--指定运行的机器--&gt;</span>
<span class="nt">&lt;env-loader&gt;</span><span class="w">    </span><span class="cm">&lt;!--设置环境变量--&gt;</span>
<span class="nt">&lt;param&gt;</span><span class="w">    </span><span class="cm">&lt;!--定义参数到参数服务器--&gt;</span>
<span class="nt">&lt;rosparam&gt;</span><span class="w">    </span><span class="cm">&lt;!--启动yaml文件参数到参数服务器--&gt;</span>
<span class="nt">&lt;arg&gt;</span><span class="w">    </span><span class="cm">&lt;!--定义变量--&gt;</span>
<span class="nt">&lt;remap&gt;</span><span class="w">    </span><span class="cm">&lt;!--设定参数映射--&gt;</span>
<span class="nt">&lt;group&gt;</span><span class="w">    </span><span class="cm">&lt;!--设定命名空间--&gt;</span>
<span class="nt">&lt;/launch&gt;</span><span class="w">    </span><span class="cm">&lt;!--根标签--&gt;</span>
</pre></div>
<blockquote><p>Tips: 一个命名习惯，一般会把机器人启动的包名命名为 xx_bringup</p>
</blockquote>
<h2>Topic</h2>
<p>异步通信，node 间 publish-subscribe 机制进行通信</p>
<p><figure><img data-width="943" data-height="188" src="/archives/assets/1733b066a98453a6bd488f7c47172d5f.png" alt="" /></figure></p>
<p>如图 <em>/Topic</em> 为自定义的 endpoint，可以多个节点向一个 topic 发布消息，一个 topic 也可以被多个节点订阅。</p>
<p>topic  的 Message 是 topic 内容的数据类型，定义在 <em>.msg 文件中，位于 `/pkg/msg/</em>.msg`</p>
<p>基本 msg 类型包括 bool、int8、int16、int32、int64(以及uint)、float、float64、string、time、duration、header、可变长数组array[]、固定长度数组array[C]</p>
<p>例如 <code>~/catkin_ws/src/exercise_three/msg/addend.msg</code> 定义了一个包括 x,y,z 三个 float 类型成员的 message</p>

<pre><code>float32 x
float32 y
float32 z</code></pre>
<p>topic 相关命令</p>
<table>
<thead><tr>
<th style="text-align:left">命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>rostopic list</code></td>
<td style="text-align:left">列出当前所有的topic</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic info topic_name</code></td>
<td style="text-align:left">显示某个topic的属性信息</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic echo topic_name</code></td>
<td style="text-align:left">显示某个topic的内容</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic pub topic_name ...</code></td>
<td style="text-align:left">向某个topic发布内容</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic bw topic_name</code></td>
<td style="text-align:left">查看某个topic的带宽</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic hz topic_name</code></td>
<td style="text-align:left">查看某个topic的频率</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic find topic_type</code></td>
<td style="text-align:left">查找某个类型的topic</td>
</tr>
<tr>
<td style="text-align:left"><code>rostopic type topic_name</code></td>
<td style="text-align:left">查看某个topic的类型(msg)</td>
</tr>
</tbody>
</table>
<h2>Service</h2>
<p>同步通信，和 topic 适用场景不同</p>
<p>node 之间通过 request-reply 的方式通信</p>
<p><figure><img data-width="1174" data-height="283" src="/archives/assets/8cab61bb4678d7cc15f838ac334d09bc.png" alt="image-20230414203125408" /><figcaption>image-20230414203125408</figcaption></figure></p>
<p>srv 是 Servive 通信的数据格式定义在 <code>pkg/srv/*.srv</code> 中，由两部分组成，以 <code>---</code> 隔开</p>
<p>上面是请求格式，下面是应答格式</p>
<p>srv 可以嵌套 msg, msg 理解成结构体、类</p>
<p>例如 <code>~/catkin_ws/src/exercise_three/srv/CallAdd.srv</code></p>

<pre><code>exercise_three/addend addend
---
float32 sum</code></pre>
<p>CallAdd 这个 srv 的请求部分中 addend 成员就是使用了 exercise_three/addend 这个 msg。</p>
<p>如果自定义了 msg 或者 srv 需要修改 <code>CMakeLists.txt</code> 和 <code>package.xml</code> 添加依赖。</p>
<p><code>package.xml</code> 中需要添加</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;build_depend&gt;</span>message_generation<span class="nt">&lt;/build_depend&gt;</span>\
<span class="nt">&lt;exec_depend&gt;</span>message_runtime<span class="nt">&lt;/exec_depend&gt;</span>
</pre></div>
<p><code>CMakeLists.txt</code> 中需要中 <code>find_package</code>中添加 <code>message_generation</code>，在 <code>catkin_package</code> 中添加 <code>message_runtime</code>，然后在 <code>add_message_files</code> 和 <code>add_service_files</code> 中指定自定义的 msg 和 srv 文件。另外需要添加 <code>generate_messages(DEPENDENCIES std_msgs)</code></p>
<p>一个编辑后的 <code>CMakeLists.txt</code> 例子</p>
<div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.0.2</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">exercise_three</span><span class="p">)</span>

<span class="nb">find_package</span><span class="p">(</span><span class="s">catkin</span><span class="w"> </span><span class="s">REQUIRED</span><span class="w"> </span><span class="s">COMPONENTS</span>
<span class="w">  </span><span class="s">message_generation</span>
<span class="w">  </span><span class="s">roscpp</span>
<span class="w">  </span><span class="s">rospy</span>
<span class="w">  </span><span class="s">std_msgs</span>
<span class="p">)</span>

<span class="nb">add_message_files</span><span class="p">(</span>
<span class="w">  </span><span class="s">FILES</span>
<span class="w">  </span><span class="s">addend.msg</span>
<span class="p">)</span>

<span class="nb">add_service_files</span><span class="p">(</span>
<span class="w">  </span><span class="s">FILES</span>
<span class="w">  </span><span class="s">CallAdd.srv</span>
<span class="p">)</span>

<span class="nb">generate_messages</span><span class="p">(</span>
<span class="w">  </span><span class="s">DEPENDENCIES</span>
<span class="w">  </span><span class="s">std_msgs</span>
<span class="p">)</span>

<span class="nb">catkin_package</span><span class="p">(</span>
<span class="w"> </span><span class="s">LIBRARIES</span><span class="w"> </span><span class="s">exercise_three</span>
<span class="w"> </span><span class="s">CATKIN_DEPENDS</span><span class="w"> </span><span class="s">roscpp</span><span class="w"> </span><span class="s">rospy</span><span class="w"> </span><span class="s">std_msgs</span><span class="w"> </span><span class="s">message_runtime</span>
<span class="p">)</span>

<span class="nb">include_directories</span><span class="p">(</span>
<span class="s">include</span>
<span class="w">  </span><span class="o">${</span><span class="nv">catkin_INCLUDE_DIRS</span><span class="o">}</span>
<span class="p">)</span>


<span class="nb">add_executable</span><span class="p">(</span><span class="s">pub_test</span><span class="w"> </span><span class="s">src/pub_test.cpp</span><span class="p">)</span>
<span class="nb">add_dependencies</span><span class="p">(</span><span class="s">pub_test</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_EXPORTED_TARGETS}</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_EXPORTED_TARGETS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">pub_test</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">sub_test</span><span class="w"> </span><span class="s">src/sub_test.cpp</span><span class="p">)</span>
<span class="nb">add_dependencies</span><span class="p">(</span><span class="s">sub_test</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_EXPORTED_TARGETS}</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_EXPORTED_TARGETS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">sub_test</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">server_call_add</span><span class="w"> </span><span class="s">src/server_call_add.cpp</span><span class="p">)</span>
<span class="nb">add_dependencies</span><span class="p">(</span><span class="s">server_call_add</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_EXPORTED_TARGETS}</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_EXPORTED_TARGETS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">server_call_add</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span><span class="s">client_call_add</span><span class="w"> </span><span class="s">src/client_call_add.cpp</span><span class="p">)</span>
<span class="nb">add_dependencies</span><span class="p">(</span><span class="s">client_call_add</span><span class="w"> </span><span class="o">${</span><span class="nv">${PROJECT_NAME</span><span class="o">}</span><span class="s">_EXPORTED_TARGETS}</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_EXPORTED_TARGETS</span><span class="o">}</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">client_call_add</span><span class="w"> </span><span class="o">${</span><span class="nv">catkin_LIBRARIES</span><span class="o">}</span><span class="p">)</span>
</pre></div>
<p>Server 相关命令</p>
<table>
<thead><tr>
<th style="text-align:left">rosservice 命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>rosservice list</code></td>
<td style="text-align:left">显示服务列表</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice info</code></td>
<td style="text-align:left">打印服务信息</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice type</code></td>
<td style="text-align:left">打印服务类型</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice uri</code></td>
<td style="text-align:left">打印服务ROSRPC uri</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice find</code></td>
<td style="text-align:left">按服务类型查找服务</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice call</code></td>
<td style="text-align:left">使用所提供的args调用服务</td>
</tr>
<tr>
<td style="text-align:left"><code>rosservice args</code></td>
<td style="text-align:left">打印服务参数</td>
</tr>
</tbody>
</table>
<h2>Parameter Server</h2>
<p>参数服务器，维护了一个字典。</p>
<ul>
<li>可以通过命令行来改变参数</li>
</ul>
<table>
<thead><tr>
<th style="text-align:left">rosparam 命令</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>rosparam set param_key param_value</code></td>
<td style="text-align:left">设置参数</td>
</tr>
<tr>
<td style="text-align:left"><code>rosparam get param_key</code></td>
<td style="text-align:left">显示参数</td>
</tr>
<tr>
<td style="text-align:left"><code>rosparam load file_name</code></td>
<td style="text-align:left">从文件加载参数</td>
</tr>
<tr>
<td style="text-align:left"><code>rosparam dump file_name</code></td>
<td style="text-align:left">保存参数到文件</td>
</tr>
<tr>
<td style="text-align:left"><code>rosparam delete</code></td>
<td style="text-align:left">删除参数</td>
</tr>
<tr>
<td style="text-align:left"><code>rosparam list</code></td>
<td style="text-align:left">列出参数名称</td>
</tr>
</tbody>
</table>
<ul>
<li><p>可以通过 load 、 dump 命令来加载、导出当前配置，dump 出的件格式是 yaml</p>
</li>
<li><p>也可以在 launch 文件中设置参数</p>
<blockquote><p>parma tag ，使用 name + value 或者 name + command，command 结果作为 value</p>
<p>rosparam tag，用法比较固定，一般就是 rosparam load 一个 yaml 文件，来批量设置一些参数</p>
</blockquote>
</li>
</ul>
<h1>roscpp</h1>
<p>roscpp 是 ROS 的 C++ 接口。</p>
<p><code>ros::init()</code> 可以初始化节点，提供的参数可以命名节点。</p>
<p>例如 <code>ros::init(argc, argv, "sub_test");</code> 初始化名为 <code>sub_test</code> 的 node。</p>
<p><code>ros::shutdown()</code> 用于关闭节点。</p>
<p>NodeHandle 是 node 的句柄，初始化时可以指定 node 的命名空间，如 <code>ros::NodeHandle nh("~");</code> 就使用了特殊的 <code>~</code> 命名空间，使用相对本 node 的路径。</p>
<p>NodeHandle 常用成员函数包括</p>
<div class="highlight"><pre><span></span><span class="c1">//创建话题的publisher </span>
<span class="n">ros</span><span class="o">::</span><span class="n">Publisher</span><span class="w"> </span><span class="nf">advertise</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queue_size</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">latch</span><span class="o">=</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span>
<span class="c1">//第一个参数为发布话题的名称</span>
<span class="c1">//第二个是消息队列的最大长度，如果发布的消息超过这个长度而没有被接收，那么就的消息就会出队。通常设为一个较小的数即可。</span>
<span class="c1">//第三个参数是是否锁存。某些话题并不是会以某个频率发布，比如/map这个topic，只有在初次订阅或者地图更新这两种情况下，/map才会发布消息。这里就用到了锁存。</span>

<span class="c1">//创建话题的subscriber</span>
<span class="n">ros</span><span class="o">::</span><span class="n">Subscriber</span><span class="w"> </span><span class="nf">subscribe</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">queue_size</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="n">M</span><span class="p">));</span>
<span class="c1">//第一个参数是订阅话题的名称</span>
<span class="c1">//第二个参数是订阅队列的长度，如果受到的消息都没来得及处理，那么新消息入队，就消息就会出队</span>
<span class="c1">//第三个参数是回调函数指针，指向回调函数来处理接收到的消息</span>

<span class="c1">//创建服务的server，提供服务</span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceServer</span><span class="w"> </span><span class="nf">advertiseService</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">(</span><span class="o">*</span><span class="n">srv_func</span><span class="p">)(</span><span class="n">Mreq</span><span class="w"> </span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">Mres</span><span class="w"> </span><span class="o">&amp;</span><span class="p">));</span><span class="w"> </span>
<span class="c1">//第一个参数是service名称</span>
<span class="c1">//第二个参数是服务函数的指针，指向服务函数。指向的函数应该有两个参数，分别接受请求和响应。</span>

<span class="c1">//创建服务的client</span>
<span class="n">ros</span><span class="o">::</span><span class="n">ServiceClient</span><span class="w"> </span><span class="nf">serviceClient</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">service_name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">persistent</span><span class="o">=</span><span class="nb">false</span><span class="p">);</span><span class="w"> </span>
<span class="c1">//第一个函数式service名称</span>
<span class="c1">//第二个参数用于设置服务的连接是否持续，如果为true，client将会保持与远程主机的连接，这样后续的请求会快一些。通常我们设为flase</span>

<span class="c1">//查询某个参数的值</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">getParam</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w"> </span>
<span class="kt">bool</span><span class="w"> </span><span class="n">getParam</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="err">；</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">getParam</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="err">；</span>
<span class="c1">//从参数服务器上获取key对应的值，已重载了多个类型</span>

<span class="c1">//给参数赋值</span>
<span class="kt">void</span><span class="w"> </span><span class="n">setParam</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="err">；</span>
<span class="kt">void</span><span class="w"> </span><span class="n">setParam</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">setParam</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="c1">//给key对应的val赋值，重载了多个类型的val</span>
</pre></div>
<h1>参考文档</h1>
<p>ROS docker 安装文档 <a href="https://wiki.ros.org/docker/Tutorials/">https://wiki.ros.org/docker/Tutorials/</a></p>
<p>在 ArchLinux 上运行  ROS：<a href="https://piero.dev/2018/02/running-ros-on-arch-linux-the-easy-way-with-docker/">https://piero.dev/2018/02/running-ros-on-arch-linux-the-easy-way-with-docker/</a></p>
<p>B站机器人操作系统入门：<a href="https://www.bilibili.com/video/BV1PJ411D7mj">https://www.bilibili.com/video/BV1PJ411D7mj</a></p>
<p>中国大学MOOC---《机器人操作系统入门》课程讲义：<a href="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/">https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/</a></p>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/ros/">#ros</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/tag/docker/">#docker</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/archives/openeuler-fix-build/">记一次简单的 openEuler 修包经历</a>
        <p class="yue">快来给 openEuler 社区做贡献吧!</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/archives/ros-install-docker/">使用 Docker 安装 ROS</a>
        <p class="yue">在 ArchLinux 上使用 docker 安装 ROS</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">SiHuan's Blog</span>
                    </section>
                    <section>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Telegram" href="https://t.me/Si_Huan" target="_blank"><i class="gi gi-telegram"></i>Telegram</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/Si-Huan" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2020-01-01T00:00+08:00"
                    </script>
                    <script src="/assets/galileo-61cf2e8279.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/assets/ExSearch/jquery.min.js"></script>
    <script src="/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="/assets/katex.min.css">
    <script defer src="/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>
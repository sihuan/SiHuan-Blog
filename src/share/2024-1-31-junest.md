---
layout: post
title: JuNestï¼
slug: junest
date: 2024-01-31 11:06
status: publish
author: SiHuaN
categories: 
  - åˆ†äº«
tags: 
  - Linux æŠ€å·§
  - ArchLinux
  - junest
excerpt: åœ¨æ—  root æƒé™çš„æƒ…å†µä¸‹åœ¨å…¶ä»–ä»»æ„ Linux å‘è¡Œç‰ˆä¸Šè¿è¡Œ ArchLinux
---

> æœ‰äº›æ—¶å€™å¯èƒ½ä¼šæ‹¿åˆ°ä¸€äº›æ²¡æœ‰ root æƒé™çš„æœºå™¨ï¼Œæ‰¾ç®¡ç†å‘˜å®‰è£…è½¯ä»¶ä¸æ–¹ä¾¿ï¼Œè€Œè‡ªå·±ç¼–è¯‘å®‰è£…è½¯ä»¶ç®¡ç†èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜è¦å¤„ç†å„ç§ä¾èµ–ã€‚åœ¨ç¾¤å‹ SteamedFish çš„æ¨èä¸‹ç”¨ä¸Šäº† JuNest è¿™ä¸ªå·¥å…·ã€‚å¦‚æœä¹‹å‰æœ‰ä½¿ç”¨è¿‡ ArchLinux çš„åŒ…ç®¡ç†çš„è¯ï¼Œç”¨èµ·æ¥ä¼šå¾ˆèˆ’æœï½ æ²¡æœ‰çš„è¯ `pacman` ä¹ŸæŒºå¥½å­¦çš„ã€‚  
> ä¸»è¦åº”ç”¨åœºæ™¯å°±æ˜¯åœ¨æ²¡æœ‰ root æƒé™çš„æœºå™¨ä¸Šå®‰è£…å„ç§è½¯ä»¶ï¼‰  
> è¿™ä¸ªé¡¹ç›®æ‰˜ç®¡åœ¨ GitHub : https://github.com/fsquillace/junest

## èµ·å› 

æˆ‘è‡ªå·±æ‹¿åˆ°äº†ä¸€å°æœåŠ¡å™¨çš„è´¦å·ï¼Œä½†æ˜¯æ²¡æœ‰ root æƒé™ï¼Œä¸Šé¢ç¼ºå¾ˆå¤šè½¯ä»¶ï¼Œè¿˜æœ‰ä¸€äº›è½¯ä»¶æ¯”è¾ƒè€æ—§ã€‚host æœºå™¨çš„æ“ä½œç³»ç»Ÿæ˜¯ Debianï¼Œä¸€å¼€å§‹æˆ‘å°è¯•ç›´æ¥ä½¿ç”¨ apt download ä¸‹è½½è½¯ä»¶åŒ…ï¼Œç„¶å dpkg å®‰è£…åˆ°æˆ‘çš„å®¶ç›®å½•ï¼Œåæ¥å‘ç°ä¾èµ–å¤„ç†èµ·æ¥å¾ˆéº»çƒ¦ã€‚ç„¶ååœ¨ç¾¤å‹çš„æ¨èä¸‹å»äº†è§£äº† `nix`ã€`gentoo-prefix` å’Œ  `linuxbrew` ç­‰å·¥å…·ï¼Œä¸€ç•ªæ–‡æ¡£çœ‹ä¸‹æ¥ï¼Œå‘ç°å®ƒä»¬å¤§å¤šåœ¨å®‰è£…æ—¶å€™éœ€è¦ root æƒé™ï¼ˆåç»­ä½¿ç”¨å¯èƒ½ä¸ç”¨ï¼‰ï¼Œè€Œå®Œå…¨ä¸éœ€è¦ root æƒé™çš„ `portable-nix` ç°åœ¨çœ‹èµ·æ¥ç¼ºä¹ç»´æŠ¤ã€‚æœ€åäº†è§£åˆ°äº† `junest`ï¼Œå¤ªå¥½ç”¨äº†ï¼äºæ˜¯å†™ç¯‡åšå®¢è®°å½•ä¸€ä¸‹ï¼Œä¸»è¦ä»‹ç»ä¸€ä¸‹å®‰è£…æ–¹æ³•ï¼Œå’Œåç»­ä½¿ç”¨ä¸­æˆ‘è‡ªå·±çš„ä¸€äº›ä¹ æƒ¯ï¼ˆä¹‹åå¯èƒ½ä¼šå†™ä¸€ä¸‹å¦‚ä½•ç›´æ¥ ssh è¿å…¥åˆ° `junest` çš„å®¹å™¨ä¸­å»ï¼Œä¸»è¦åº”ç”¨åœºæ™¯å°±æ˜¯ç»™ vscode remote ç”¨äº†ï¼‰ã€‚

## å‡†å¤‡

### è¯»é¡¹ç›®ä»‹ç»

**JuNest** (Jailed User Nest) is a lightweight Arch Linux based distribution
that allows the creation of disposable and partially isolated GNU/Linux environments
within any generic GNU/Linux host OS and without requiring root
privileges to install packages.

JuNest is built around [pacman](https://wiki.archlinux.org/index.php/Pacman),
the Arch Linux package manager, which allows access
to a wide range of packages from the Arch Linux repositories.

The main advantages of using JuNest include:

- Install packages without root privileges.
- Create partially isolated environments in which you can install packages without risking mishaps on production systems.
- Access a wider range of packages, particularly on GNU/Linux distros with comparatively limited repositories (such as CentOS and Red Hat).
- Run on a different architecture from the host OS via QEMU.
- Available for `x86_64` and `arm` architectures but you can build your own image from scratch too!
- All Arch Linux lovers can enjoy their favourite distro everywhere!

JuNest follows the [Arch Linux philosophy](https://wiki.archlinux.org/index.php/The_Arch_Way).


### å‡†å¤‡ç³»ç»Ÿ

ä½ è‡³å°‘è¦æœ‰ä¸€ä¸ªå¯ä»¥ç™»å½•çš„è´¦æˆ·ï¼Œå…¨è¿‡ç¨‹ä¸éœ€è¦ root æƒé™ï¼Œjunest æ”¯æŒ `namespace`ã€`proot` å’Œ `chroot` ä¸‰ç§åç«¯ï¼Œå…¶ä¸­ `chroot` éœ€è¦ root æƒé™ï¼Œå°±ä¸å¤šåšè®¨è®ºäº†ã€‚å‰ä¸¤è€…æˆ‘æ›´æ¨è `namespace` çš„å®ç°ï¼Œå…·ä½“åŒºåˆ«å¯ä»¥å»é˜…è¯» junset çš„æ–‡æ¡£ï¼ˆ~~å…¶å®åœ¨ junest çš„æ–‡æ¡£é‡Œå®‰è£…ä½¿ç”¨ä¹Ÿå†™å¾—å¾ˆæ¸…æ¥šäº†~~ï¼‰ã€‚å¯ä»¥æŸ¥é˜…[è¿™ä¸ªè¡¨æ ¼](https://github.com/fsquillace/junest/wiki/Linux-distros-with-user-namespace-enabled-by-default)æ¥æŸ¥çœ‹è‡ªå·±çš„ host ç³»ç»Ÿæ˜¯å¦é»˜è®¤å¼€å¯äº†ç”¨æˆ·å‘½åç©ºé—´ã€‚ArchLinux å’Œæ¯”è¾ƒæ–°ç‰ˆæœ¬çš„ Debianã€Ubuntu éƒ½æ˜¯å¼€äº†çš„ã€‚

## å®‰è£…

> junest è¿˜æ˜¯æœ‰ä¸€äº›ä¾èµ–çš„ï¼Œéœ€è¦æœåŠ¡å™¨ä¸Šå·²ç»æ»¡è¶³ä»¥ä¸‹ä¾èµ–  
> bash (>=4.0) GNU coreutils  
> å¦å¤–å®‰è£…è¿‡ç¨‹ä¸­æœ‰ç”¨åˆ° git


ä½¿ç”¨ ssh é“¾æ¥åˆ°æœåŠ¡å™¨ï¼Œå°† junest ä»“åº“ clone åˆ° ` ~/.local/share/junest`

```bash
# æ–°å»ºç›®å½•
mkdir ~/.local/share/junest
# clone ä»“åº“ï¼ˆç½‘ç»œé—®é¢˜æ˜¯å¦å¤–çš„è¯é¢˜ï¼‰
git clone https://github.com/fsquillace/junest.git ~/.local/share/junest
```

å°† junest æ·»åŠ åˆ° PATHï¼Œä»¥ä¾¿ä½ å¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨å®ƒ

```bash
export PATH=~/.local/share/junest/bin:$PATH
```

å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½æ‰§è¡Œä¸Šè¿° export å‘½ä»¤å¯ä»¥å°†å®ƒå†™å…¥åˆ° `~/.bashrc` ä¸­ï¼Œè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾å³å¯ã€‚å®Œæˆç¼–è¾‘åéœ€è¦æ‰§è¡Œ `source ~/.bashrc` ç”Ÿæ•ˆï¼Œæˆ–è€…å¹²è„†ç™»å‡º ssh é‡æ–°ç™»å½•ã€‚

ç°åœ¨ä½ å¯ä»¥è®¾ç½® `JUNEST_HOME` è¿™ä¸ªç¯å¢ƒå˜é‡ä»¥æ§åˆ¶ junest çš„å®‰è£…ä½ç½®ï¼Œé»˜è®¤æ˜¯ `.junest`ï¼Œæˆ‘æ˜¯ä½¿ç”¨äº†é»˜è®¤çš„ä½ç½®

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆå®‰è£…

```bash
junest setup
```

ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œæ²¡æœ‰å‡ºé”™çš„è¯å°±å®Œæˆäº†å®‰è£…ã€‚

## ä½¿ç”¨ junest ç¯å¢ƒ

åœ¨ä½ å®Œæˆå®‰è£…ä¹‹åï¼Œssh è¿å…¥æœåŠ¡å™¨æ˜¯åœ¨ host æœºå™¨çš„ç¯å¢ƒå½“ä¸­ï¼Œç°åœ¨ä½ ä½¿ç”¨çš„å„ç§å·¥å…·éƒ½æ˜¯ host æœºå™¨æä¾›çš„ã€‚  
æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥ä½¿ç”¨ junest é‡Œçš„ archlinux æä¾›çš„è½¯ä»¶ã€‚

1. ä½¿ç”¨ junest å‘½ä»¤è¿›å…¥åˆ°å®¹å™¨é‡Œ

    ```bash
    # è¿›å…¥å®¹å™¨
    junest
    # ç°åœ¨å·²ç»åœ¨ junest é‡Œé¢äº†ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ pacman
    pacman --version
    ```

2. ç»™ junest å‘½ä»¤ä¼ é€’å‚æ•°ï¼ˆï¼Ÿï¼‰

    ```bash
    # ç°åœ¨æ˜¯åœ¨ host ç¯å¢ƒä¸Šï¼Œç›´æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ä½¿ç”¨ junest å®¹å™¨é‡Œçš„ pacman
    junest pacman --version
    ```

3. ç›´æ¥åœ¨ host æœºå™¨ä¸Šä½¿ç”¨ junest é‡Œå®‰è£…çš„ç¨‹åº

    æˆ‘ä¸æ¨èè¿™ç§æ–¹å¼ï¼ŒåŸå› æ˜¯è¿™ç§æƒ…å†µä¼šä¼˜å…ˆä½¿ç”¨ host æœºå™¨ä¸Šçš„ç¨‹åºï¼Œå¦‚æœä½  host æœºå™¨ä¸Šå®‰è£…äº†è€ç‰ˆæœ¬ï¼ˆä¸ç¬¦åˆéœ€æ±‚çš„ï¼‰ç¨‹åºï¼Œjunest é‡Œå®‰è£…äº†æ–°çš„ç‰ˆæœ¬ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šä¼˜å…ˆä½¿ç”¨ host æœºå™¨ä¸Šçš„ç‰ˆæœ¬ã€‚  
    å¦‚æœç¡®å®è¿™ç§æ–¹å¼çš„ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/fsquillace/junest/tree/master?tab=readme-ov-file#run-junest-installed-programs-directly-from-host-os


æˆ‘è‡ªå·±æ¯”è¾ƒæ¨èç¬¬ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥è¿›å…¥åˆ° junest å®¹å™¨ä¸­ï¼Œå®Œå…¨ä½¿ç”¨ junest é‡Œçš„ç¨‹åºï¼Œå’Œ host æœºå™¨åˆ’æ¸…ç•Œé™ï¼ˆ  
å¯ä»¥åœ¨ `~/.bashrc` ä¸­è¿½åŠ ä»¥ä¸‹å†…å®¹æ¥ä½¿æ¯æ¬¡ ssh è¿å…¥åè‡ªåŠ¨è¿›å…¥ junest ç¯å¢ƒã€‚

```bash
if [ ! -f /usr/bin/pacman ]; then
    junest
fi
```



## ä¹‹åçš„é…ç½®

é€šè¿‡ junest å‘½ä»¤è¿›å…¥ç¯å¢ƒä¹‹åï¼Œä½ é¢å¯¹çš„å°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„ archlinux ç³»ç»Ÿäº†ï¼Œåœ¨è¿™é‡Œä½ æ‹¥æœ‰ï¼ˆè™šå‡çš„ï¼‰root æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤  
å†ä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¼–è¾‘ pacman çš„é…ç½®æ–‡ä»¶æ¥å¯ç”¨ä¸€ä¸ªé•œåƒç«™ç‚¹ã€‚

å¦‚æœä½ åœ¨ junest é‡Œï¼Œé‚£ä¹ˆä½ éœ€è¦ç¼–è¾‘çš„æ–‡ä»¶æ˜¯ `/etc/pacman.d/mirrorlist`ï¼Œå¦‚æœ junest ç¯å¢ƒé‡Œå°šæœªæœ‰ä½ å–œæ¬¢çš„ç¼–è¾‘å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ `exit` å‘½ä»¤æˆ– `Ctrl+D` é€€å‡º junest åˆ° host ç¯å¢ƒï¼Œç„¶ååˆ©ç”¨ host ç¯å¢ƒé‡Œå·²ç»æœ‰çš„ç¼–è¾‘å·¥å…·å»ç¼–è¾‘ `~/.junest/etc/pacman.d/mirrorlist`ã€‚

åœ¨ä¸Šé¢æåŠçš„ mirrorlist æ–‡ä»¶æœ€å‰æ®µæ·»åŠ ä½ æƒ³ä½¿ç”¨çš„é•œåƒç«™ç«™ç‚¹ï¼Œæ¯”å¦‚ï¼Œè¦ä½¿ç”¨å±±ä¸œç§‘æŠ€å¤§å­¦çš„å¼€æºé•œåƒç½‘ç«™ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹

```text
Server = https://mirrors.sdust.edu.cn/archlinux/$repo/os/$arch
# æ¸…åå¤§å­¦ tuna é•œåƒç«™çš„è¯å°±æ˜¯ä»¥ä¸‹å†…å®¹
# Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
```

å®Œæˆä¸Šè¿°ç¼–è¾‘ä¹‹åï¼Œç¡®ä¿ä½ å›åˆ° junest ç¯å¢ƒä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–°ä¸€ä¸‹ junest é‡Œçš„ archlinux åŒæ—¶å®‰è£…ä¸€äº›ç›¸å½“åŸºç¡€çš„è½¯ä»¶

```bash
sudo pacman -Syyu
sudo pacman -S glibc
```

å®Œæˆä¹‹åä½ å°±å¯ä»¥ç”¨ pacman æ¥å®‰è£…è‡ªå·±æ‰€éœ€çš„è½¯ä»¶åŒ…äº†ï¼Œä¾‹å¦‚

```bash
# å®‰è£… vimã€ninjaã€cmake å’Œ python
sudo pacman -S vim ninja cmake python
```

å…³äº pacman çš„ç”¨æ³•å¯ä»¥å»çœ‹ archlinux çš„æ–‡æ¡£ï¼Œå¦å¤–éœ€è¦æ³¨æ„ archlinux ä¸Šæœ‰äº›åŒ…åå¯èƒ½å’Œä½ æ­£åœ¨ä½¿ç”¨çš„å‘è¡Œç‰ˆä¸ä¸€æ ·ï¼Œå¯ä»¥ç”¨ `-Ss` å‚æ•°æ¥æŸ¥æ‰¾è½¯ä»¶åŒ…ï¼Œä¾‹å¦‚

```console
$ pacman -Ss ninja
extra/gn 0.2130.7367b0df-1
    Meta-build system that generates build files for Ninja
extra/ninja 1.11.1-3 [installed]
    Small build system with a focus on speed
extra/ninjas2 0.2.0-3
    A sample slicer audio plugin
extra/ninjas2-lv2 0.2.0-3 (lv2-plugins pro-audio)
    A sample slicer audio plugin - LV2 plugin
extra/ninjas2-standalone 0.2.0-3 (pro-audio)
    A sample slicer audio plugin - JACK standalone
extra/ninjas2-vst 0.2.0-3 (vst-plugins pro-audio)
    A sample slicer audio plugin - VST plugin
extra/samurai 1.2-2
    ninja-compatible build tool written in C
```

å…·ä½“çš„ç”¨æ³•è¿˜æ˜¯å»å‚è€ƒ archlinux çš„æ–‡æ¡£å§ï½

ç°åœ¨ä½ å¯ä»¥åœ¨ junest é‡Œè‡ªç”±çš„å®‰è£…å¹¶ä½¿ç”¨å„ç§æ‰€éœ€çš„è½¯ä»¶è€Œå…¨ç¨‹ä¸éœ€è¦ host æœºå™¨çš„ root æƒé™ã€‚

## æŒ–å‘

æœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰ç›´æ¥ ssh è¿æ¥åˆ° junest å®¹å™¨é‡Œçš„éœ€æ±‚ï¼ˆè€Œä¸æ˜¯å…ˆè¿æ¥åˆ° host æœºå™¨ï¼Œå†ä½¿ç”¨ junest å‘½ä»¤è¿›å…¥å®¹å™¨ï¼‰ï¼Œæˆ‘çš„åº”ç”¨åœºæ™¯å°±æ˜¯ç»™ vscode remote ç”¨ã€‚å¤§æ¦‚éœ€è¦ä»¥ä¸‹æ­¥éª¤

- ç»™ junest é‡Œçš„ archlinux å®‰è£…ä¸€ä¸ªæ‰“è¿‡è¡¥ä¸çš„ opensshï¼ˆä¸ºçš„æ˜¯è§£å†³ä¸€ç‚¹å°å°çš„æƒé™é—®é¢˜ï¼‰

- é…ç½®å¹¶å¯åŠ¨ junest é‡Œçš„ sshd æœåŠ¡

- å¯èƒ½çš„ï¼Œå¦‚æœä½ çš„ host æœºå™¨æœ‰é˜²ç«å¢™ï¼Œä¸èƒ½å°† junest é‡Œçš„ sshd æœåŠ¡æš´éœ²åˆ°ä½ å¯ä»¥è®¿é—®çš„ç½‘ç»œä¸Šï¼Œå°±éœ€è¦é…ç½®ä¸‹è·³æ¿

å…³äºä¸Šè¿°æ­¥éª¤å¯ä»¥å‚è€ƒ  [@ayaka_45434/installing-packages-on-linux-without-sudo-privilege-using-junest]( https://medium.com/@ayaka_45434/installing-packages-on-linux-without-sudo-privilege-using-junest-5fe7523c9d86#:~:text=Step%205%3A%20Install%20and%20run%20an%20SSH%20server%20in%20the%20JuNest%20environment)

å…·ä½“æ­¥éª¤å’Œå¯èƒ½è¸©çš„å‘æˆ‘å¯èƒ½ä¹Ÿè®¸å¤§æ¦‚ä¼šå†æ°´ä¸€ç¯‡ blog :)

**EOF**

å¿«å»çœ‹ It's MyGO å§ï¼Œç›¸å½“å¥½çœ‹ğŸ˜­ğŸ˜­ğŸ˜­